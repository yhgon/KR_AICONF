# ResNet-50 

Unpack DGX-2


### Check system
this system configuration is  base clock.
so below benchmark number is slower than NVIDIA's original performance benchmark result.

```
$ nvidia-smi -L
GPU 0: Tesla V100-SXM3-32GB (UUID: GPU-)
GPU 1: Tesla V100-SXM3-32GB (UUID: GPU-)
GPU 2: Tesla V100-SXM3-32GB (UUID: GPU-)
GPU 3: Tesla V100-SXM3-32GB (UUID: GPU-)
GPU 4: Tesla V100-SXM3-32GB (UUID: GPU-)
GPU 5: Tesla V100-SXM3-32GB (UUID: GPU-)
GPU 6: Tesla V100-SXM3-32GB (UUID: GPU-)
GPU 7: Tesla V100-SXM3-32GB (UUID: GPU-)
GPU 8: Tesla V100-SXM3-32GB (UUID: GPU-)
GPU 9: Tesla V100-SXM3-32GB (UUID: GPU-)
GPU 10: Tesla V100-SXM3-32GB (UUID: GPU)
GPU 11: Tesla V100-SXM3-32GB (UUID: GPU)
GPU 12: Tesla V100-SXM3-32GB (UUID: GPU)
GPU 13: Tesla V100-SXM3-32GB (UUID: GPU)
GPU 14: Tesla V100-SXM3-32GB (UUID: GPU)
GPU 15: Tesla V100-SXM3-32GB (UUID: GPU)
```
#### Link

```
$ nvidia-smi nvlink -s		        
GPU 0: Tesla V100-SXM3-32GB (UUID: GPU- 
	 Link 0: 25.781 GB/s	        
	 Link 1: 25.781 GB/s	        
	 Link 2: 25.781 GB/s	        
	 Link 3: 25.781 GB/s	        
	 Link 4: 25.781 GB/s	        
	 Link 5: 25.781 GB/s	        
GPU 1: Tesla V100-SXM3-32GB (UUID: GPU- 
	 Link 0: 25.781 GB/s	        
	 Link 1: 25.781 GB/s	        
	 Link 2: 25.781 GB/s	        
	 Link 3: 25.781 GB/s	        
	 Link 4: 25.781 GB/s	        
	 Link 5: 25.781 GB/s	        
GPU 2: Tesla V100-SXM3-32GB (UUID: GPU- 
	 Link 0: 25.781 GB/s	        
	 Link 1: 25.781 GB/s	        
	 Link 2: 25.781 GB/s	        
	 Link 3: 25.781 GB/s	        
	 Link 4: 25.781 GB/s	        
	 Link 5: 25.781 GB/s	        
GPU 3: Tesla V100-SXM3-32GB (UUID: GPU- 
	 Link 0: 25.781 GB/s	        
	 Link 1: 25.781 GB/s	        
	 Link 2: 25.781 GB/s	        
	 Link 3: 25.781 GB/s	        
	 Link 4: 25.781 GB/s	        
	 Link 5: 25.781 GB/s	        
GPU 4: Tesla V100-SXM3-32GB (UUID: GPU- 
	 Link 0: 25.781 GB/s	        
	 Link 1: 25.781 GB/s	        
	 Link 2: 25.781 GB/s	        
	 Link 3: 25.781 GB/s	        
	 Link 4: 25.781 GB/s	        
	 Link 5: 25.781 GB/s	        
GPU 5: Tesla V100-SXM3-32GB (UUID: GPU- 
	 Link 0: 25.781 GB/s	        
	 Link 1: 25.781 GB/s	        
	 Link 2: 25.781 GB/s	        
	 Link 3: 25.781 GB/s	        
	 Link 4: 25.781 GB/s	        
	 Link 5: 25.781 GB/s	        
GPU 6: Tesla V100-SXM3-32GB (UUID: GPU- 
	 Link 0: 25.781 GB/s	        
	 Link 1: 25.781 GB/s	        
	 Link 2: 25.781 GB/s	        
	 Link 3: 25.781 GB/s	        
	 Link 4: 25.781 GB/s	        
	 Link 5: 25.781 GB/s	        
GPU 7: Tesla V100-SXM3-32GB (UUID: GPU- 
	 Link 0: 25.781 GB/s	        
	 Link 1: 25.781 GB/s	        
	 Link 2: 25.781 GB/s	        
	 Link 3: 25.781 GB/s	        
	 Link 4: 25.781 GB/s	        
	 Link 5: 25.781 GB/s	        
GPU 8: Tesla V100-SXM3-32GB (UUID: GPU- 
	 Link 0: 25.781 GB/s	        
	 Link 1: 25.781 GB/s	        
	 Link 2: 25.781 GB/s	        
	 Link 3: 25.781 GB/s	        
	 Link 4: 25.781 GB/s	        
	 Link 5: 25.781 GB/s	        
GPU 9: Tesla V100-SXM3-32GB (UUID: GPU- 
	 Link 0: 25.781 GB/s	        
	 Link 1: 25.781 GB/s	        
	 Link 2: 25.781 GB/s	        
	 Link 3: 25.781 GB/s	        
	 Link 4: 25.781 GB/s	        
	 Link 5: 25.781 GB/s	        
GPU 10: Tesla V100-SXM3-32GB (UUID: GPU )
	 Link 0: 25.781 GB/s	        
	 Link 1: 25.781 GB/s	        
	 Link 2: 25.781 GB/s	        
	 Link 3: 25.781 GB/s	        
	 Link 4: 25.781 GB/s	        
	 Link 5: 25.781 GB/s	        
GPU 11: Tesla V100-SXM3-32GB (UUID: GPU )
	 Link 0: 25.781 GB/s	        
	 Link 1: 25.781 GB/s	        
	 Link 2: 25.781 GB/s	        
	 Link 3: 25.781 GB/s	        
	 Link 4: 25.781 GB/s	        
	 Link 5: 25.781 GB/s	        
GPU 12: Tesla V100-SXM3-32GB (UUID: GPU )
	 Link 0: 25.781 GB/s	        
	 Link 1: 25.781 GB/s	        
	 Link 2: 25.781 GB/s	        
	 Link 3: 25.781 GB/s	        
	 Link 4: 25.781 GB/s	        
	 Link 5: 25.781 GB/s	        
GPU 13: Tesla V100-SXM3-32GB (UUID: GPU )
	 Link 0: 25.781 GB/s	        
	 Link 1: 25.781 GB/s	        
	 Link 2: 25.781 GB/s	        
	 Link 3: 25.781 GB/s	        
	 Link 4: 25.781 GB/s	        
	 Link 5: 25.781 GB/s	        
GPU 14: Tesla V100-SXM3-32GB (UUID: GPU )
	 Link 0: 25.781 GB/s	        
	 Link 1: 25.781 GB/s	        
	 Link 2: 25.781 GB/s	        
	 Link 3: 25.781 GB/s	        
	 Link 4: 25.781 GB/s	        
	 Link 5: 25.781 GB/s	        
GPU 15: Tesla V100-SXM3-32GB (UUID: GPU )
	 Link 0: 25.781 GB/s
	 Link 1: 25.781 GB/s
	 Link 2: 25.781 GB/s
	 Link 3: 25.781 GB/s
	 Link 4: 25.781 GB/s
	 Link 5: 25.781 GB/s
   ```

#### topology
```
$ nvidia-smi topo -m
	GPU0	GPU1	GPU2	GPU3	GPU4	GPU5	GPU6	GPU7	GPU8	GPU9	GPU10	GPU11	GPU12	GPU13	GPU14	GPU15	CPU Affinity
GPU0	 X 	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	0-23,48-71
GPU1	NV6	 X 	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	0-23,48-71
GPU2	NV6	NV6	 X 	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	0-23,48-71
GPU3	NV6	NV6	NV6	 X 	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	0-23,48-71
GPU4	NV6	NV6	NV6	NV6	 X 	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	0-23,48-71
GPU5	NV6	NV6	NV6	NV6	NV6	 X 	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	0-23,48-71
GPU6	NV6	NV6	NV6	NV6	NV6	NV6	 X 	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	0-23,48-71
GPU7	NV6	NV6	NV6	NV6	NV6	NV6	NV6	 X 	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	0-23,48-71
GPU8	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	 X 	NV6	NV6	NV6	NV6	NV6	NV6	NV6	24-47,72-95
GPU9	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	 X 	NV6	NV6	NV6	NV6	NV6	NV6	24-47,72-95
GPU10	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	 X 	NV6	NV6	NV6	NV6	NV6	24-47,72-95
GPU11	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	 X 	NV6	NV6	NV6	NV6	24-47,72-95
GPU12	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	 X 	NV6	NV6	NV6	24-47,72-95
GPU13	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	 X 	NV6	NV6	24-47,72-95
GPU14	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	 X 	NV6	24-47,72-95
GPU15	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	NV6	 X 	24-47,72-95

Legend:

  X    = Self
  SYS  = Connection traversing PCIe as well as the SMP interconnect between NUMA nodes (e.g., QPI/UPI)
  NODE = Connection traversing PCIe as well as the interconnect between PCIe Host Bridges within a NUMA node
  PHB  = Connection traversing PCIe as well as a PCIe Host Bridge (typically the CPU)
  PXB  = Connection traversing multiple PCIe switches (without traversing the PCIe Host Bridge)
  PIX  = Connection traversing a single PCIe switch
  NV#  = Connection traversing a bonded set of # NVLinks
```

### Step1. docker pull NGC recent NGC tensorflow image

```
docker pull  nvcr.io/nvidia/tensorflow:18.10-py3
```

### Step2. 
```
nvidia-docker run -it -v mnt/hryu:/mnt/hryu nvcr.io/nvidia/tensorflow:18.10-py3 bash
```
### step3. train with singleGPU (synthetic dataset)
```
python /workspace/nvidia-examples/cnn/resnet.py  --layers=50  --precision=fp32   --num_iter=400  --iter_unit=batch  --batch_size 128
```

### step4. train with 16 GPUs (synthetic dataset)
```
mpirun --allow-run-as-root  --bind-to socket   -np 16 python /workspace/nvidia-examples/cnn/resnet.py --data_dir=/mnt/hryu/dataset-tf/train-val-tfrecord-480-subset --log_dir=/mnt/hryu/result/try3   --layers=50  --precision=fp16   --num_iter=400  --iter_unit=batch  --batch_size 256
```



#### GPU Utilization
```

Thu Oct 18 02:15:17 2018       
+-----------------------------------------------------------------------------+
| NVIDIA-SMI 410.33                 Driver Version: 410.33                    |
|-------------------------------+----------------------+----------------------+
| GPU  Name        Persistence-M| Bus-Id        Disp.A | Volatile Uncorr. ECC |
| Fan  Temp  Perf  Pwr:Usage/Cap|         Memory-Usage | GPU-Util  Compute M. |
|===============================+======================+======================|
|   0  Tesla V100-SXM3...  On   | 00000000:34:00.0 Off |                    0 |
| N/A   54C    P0   271W / 350W |  23596MiB / 32510MiB |     92%      Default |
+-------------------------------+----------------------+----------------------+
|   1  Tesla V100-SXM3...  On   | 00000000:36:00.0 Off |                    0 |
| N/A   53C    P0   325W / 350W |  23596MiB / 32510MiB |     96%      Default |
+-------------------------------+----------------------+----------------------+
|   2  Tesla V100-SXM3...  On   | 00000000:39:00.0 Off |                    0 |
| N/A   69C    P0   309W / 350W |  23596MiB / 32510MiB |     93%      Default |
+-------------------------------+----------------------+----------------------+
|   3  Tesla V100-SXM3...  On   | 00000000:3B:00.0 Off |                    0 |
| N/A   67C    P0   301W / 350W |  23596MiB / 32510MiB |     90%      Default |
+-------------------------------+----------------------+----------------------+
|   4  Tesla V100-SXM3...  On   | 00000000:57:00.0 Off |                    0 |
| N/A   56C    P0   159W / 350W |  23596MiB / 32510MiB |     96%      Default |
+-------------------------------+----------------------+----------------------+
|   5  Tesla V100-SXM3...  On   | 00000000:59:00.0 Off |                    0 |
| N/A   70C    P0   360W / 350W |  23591MiB / 32510MiB |     92%      Default |
+-------------------------------+----------------------+----------------------+
|   6  Tesla V100-SXM3...  On   | 00000000:5C:00.0 Off |                    0 |
| N/A   55C    P0   284W / 350W |  23596MiB / 32510MiB |     98%      Default |
+-------------------------------+----------------------+----------------------+
|   7  Tesla V100-SXM3...  On   | 00000000:5E:00.0 Off |                    0 |
| N/A   68C    P0   311W / 350W |  23596MiB / 32510MiB |     93%      Default |
+-------------------------------+----------------------+----------------------+
|   8  Tesla V100-SXM3...  On   | 00000000:B7:00.0 Off |                    0 |
| N/A   53C    P0   311W / 350W |  23596MiB / 32510MiB |     92%      Default |
+-------------------------------+----------------------+----------------------+
|   9  Tesla V100-SXM3...  On   | 00000000:B9:00.0 Off |                    0 |
| N/A   53C    P0   140W / 350W |  23596MiB / 32510MiB |     98%      Default |
+-------------------------------+----------------------+----------------------+
|  10  Tesla V100-SXM3...  On   | 00000000:BC:00.0 Off |                    0 |
| N/A   68C    P0   328W / 350W |  23596MiB / 32510MiB |     94%      Default |
+-------------------------------+----------------------+----------------------+
|  11  Tesla V100-SXM3...  On   | 00000000:BE:00.0 Off |                    0 |
| N/A   68C    P0   319W / 350W |  23596MiB / 32510MiB |     90%      Default |
+-------------------------------+----------------------+----------------------+
|  12  Tesla V100-SXM3...  On   | 00000000:E0:00.0 Off |                    0 |
| N/A   53C    P0   249W / 350W |  23596MiB / 32510MiB |     97%      Default |
+-------------------------------+----------------------+----------------------+
|  13  Tesla V100-SXM3...  On   | 00000000:E2:00.0 Off |                    0 |
| N/A   53C    P0   313W / 350W |  23596MiB / 32510MiB |     92%      Default |
+-------------------------------+----------------------+----------------------+
|  14  Tesla V100-SXM3...  On   | 00000000:E5:00.0 Off |                    0 |
| N/A   67C    P0   291W / 350W |  23596MiB / 32510MiB |     93%      Default |
+-------------------------------+----------------------+----------------------+
|  15  Tesla V100-SXM3...  On   | 00000000:E7:00.0 Off |                    0 |
| N/A   67C    P0   296W / 350W |  23596MiB / 32510MiB |     94%      Default |
+-------------------------------+----------------------+----------------------+
                                                                               
+-----------------------------------------------------------------------------+
| Processes:                                                       GPU Memory |
|  GPU       PID   Type   Process name                             Usage      |
|=============================================================================|
+-----------------------------------------------------------------------------+

```

#### result FP32, batch 128
```
P32 128 batch 
rm -rf /mnt/hryu-pggan/result/try3  && cd /workspace/nvidia-examples && mpirun --allow-run-as-root  --bind-to socket   -np 16 python /workspace/nvidia-examples/cnn/resnet.py --data_dir=/mnt/hryu-pggan/dataset-tfrain-val-tfrecord-480-subset --log_dir=/mnt/hryu-pggan/result/try3   --layers=50  --precision=fp32   --num_iter=400  --iter_unit=batch  --batch_size 128


  Step Epoch Img/sec   Loss  LR
    10   0.2   599.4  7.233  8.204 1.99413
    20   0.3  4183.0  7.139  8.108 1.98680
    30   0.5  4346.2  6.789  7.753 1.97949
    40   0.7  4448.1  6.773  7.727 1.97219
    50   0.8  4668.3  6.454  7.396 1.96490
    60   1.0  5748.3  6.468  7.394 1.95763
    70   1.2  5741.2  6.451  7.360 1.95037
    80   1.3  5798.8  6.188  7.079 1.94312
    90   1.5  5739.4  6.185  7.057 1.93589
   100   1.7  5748.7  6.014  6.868 1.92867
   110   1.8  5751.0  6.106  6.943 1.92146
   120   2.0  5711.6  5.920  6.740 1.91427
   130   2.1  5747.6  6.012  6.817 1.90709
   140   2.3  5727.3  5.840  6.630 1.89993
   150   2.5  5760.7  5.833  6.610 1.89277
   160   2.6  5748.2  5.828  6.592 1.88563
   170   2.8  5737.9  5.687  6.439 1.87851
   180   3.0  5763.1  5.396  6.137 1.87140
   190   3.1  5726.4  5.386  6.115 1.86430
   200   3.3  5738.2  5.437  6.157 1.85722
   210   3.5  5729.4  5.345  6.056 1.85014
   220   3.6  5711.4  5.373  6.074 1.84309
   230   3.8  5736.6  5.237  5.930 1.83604
   240   4.0  5749.6  5.186  5.871 1.82901
   250   4.1  5718.8  5.301  5.978 1.82200
   260   4.3  5750.4  5.208  5.879 1.81499
   270   4.5  5705.4  5.104  5.768 1.80800
   280   4.6  5734.4  5.011  5.669 1.80103
   290   4.8  5734.1  5.138  5.791 1.79406
   300   5.0  5745.9  5.072  5.719 1.78711
   310   5.1  5780.5  4.884  5.526 1.78018
   320   5.3  5746.7  5.000  5.638 1.77325
   330   5.5  5756.3  4.858  5.491 1.76634
   340   5.6  5752.0  4.706  5.334 1.75945
   350   5.8  5752.1  4.758  5.383 1.75257
   360   5.9  5757.6  4.680  5.301 1.74570
   370   6.1  5751.3  5.187  5.805 1.73884
   380   6.3  5727.7  4.778  5.392 1.73200
   390   6.4  5711.9  4.696  5.307 1.72517
   400   6.6  5707.4  4.775  5.384 1.71836

Evaluating
Top-1 accuracy: 10.144927352666855 %
Top-5 accuracy: 25.973287224769592 %
```

#### log
```

80 epoch 
rm -rf /mnt/hryu-pggan/result/try3  && cd /workspace/nvidia-examples && mpirun --allow-run-as-root  --bind-to socket   -np 16 python /workspace/nvidia-examples/cnn/resnet.py --data_dir=/mnt/hryu-pggan/dataset-tf/train-val-tfrecord-480-subset --log_dir=/mnt/hryu-pggan/result/try3   --layers=50  --precision=fp16   --num_iter=90  --iter_unit=epoch  --batch_size 256
  Step Epoch Img/sec   Loss  LR
      10   0.3  1142.5  7.173  8.144 1.98827
    20   0.7 11022.0  7.500  8.469 1.97365
    30   1.0 11569.0  6.869  7.833 1.95908
    40   1.3 11952.0  6.764  7.720 1.94457
    50   1.7 11917.2  6.702  7.649 1.93011
    60   2.0 11927.0  6.536  7.468 1.91571
    70   2.3 11930.3  6.321  7.237 1.90136
    80   2.6 11961.9  6.450  7.348 1.88706
    90   3.0 11928.7  6.134  7.016 1.87282
   100   3.3 11912.9  6.071  6.935 1.85863
   110   3.6 11926.8  6.132  6.979 1.84450
   120   4.0 11939.5  5.831  6.663 1.83042
   130   4.3 11960.1  5.711  6.528 1.81639
   140   4.6 11951.3  5.911  6.714 1.80242
   150   5.0 11959.3  5.618  6.408 1.78850
   160   5.3 11918.8  5.662  6.441 1.77464
   170   5.6 11977.4  5.689  6.457 1.76083
   180   5.9 11958.6  5.405  6.163 1.74707
   190   6.3 11944.3  5.347  6.096 1.73337
   200   6.6 11906.2  5.442  6.184 1.71972
   210   6.9 11956.3  5.461  6.195 1.70612
   220   7.3 11899.7  4.989  5.716 1.69258
   230   7.6 11904.3  5.175  5.896 1.67910
   240   7.9 11932.9  5.134  5.849 1.66566
   250   8.3 11977.9  4.910  5.620 1.65229
   260   8.6 11944.2  4.809  5.514 1.63896
   270   8.9 11889.3  4.716  5.415 1.62569
   280   9.3 11921.5  4.652  5.347 1.61247
   290   9.6 11930.4  4.779  5.470 1.59931
   300   9.9 11911.4  4.680  5.367 1.58620
   310  10.2 11904.2  4.709  5.393 1.57315
   320  10.6 11948.0  4.416  5.096 1.56014
   330  10.9 11921.6  4.627  5.303 1.54720
   340  11.2 11876.1  4.870  5.543 1.53430
   350  11.6 11907.8  4.562  5.233 1.52146
   360  11.9 11926.7  4.459  5.127 1.50868
   370  12.2 11919.7  4.433  5.098 1.49595
   380  12.6 11913.6  4.484  5.147 1.48327
   390  12.9 11894.2  4.355  5.015 1.47065
   400  13.2 11913.8  4.531  5.189 1.45808
   410  13.5 11949.4  4.223  4.879 1.44556
   420  13.9 11907.8  4.278  4.932 1.43310
   430  14.2 11912.3  4.389  5.041 1.42069
   440  14.5 11931.1  4.057  4.708 1.40834
   450  14.9 11915.4  3.991  4.640 1.39604
   460  15.2 11950.3  4.083  4.730 1.38379
   470  15.5 11890.7  3.968  4.614 1.37160
   480  15.9 11888.4  3.976  4.620 1.35946
   490  16.2 11912.5  3.864  4.506 1.34738
   500  16.5 11928.5  4.026  4.667 1.33535
   510  16.9 11951.1  3.791  4.431 1.32337
   520  17.2 11912.7  3.890  4.528 1.31145
   530  17.5 11950.9  3.676  4.313 1.29958
   540  17.8 11947.7  3.627  4.263 1.28777
   550  18.2 11922.8  3.780  4.414 1.27601
   560  18.5 11936.8  3.879  4.513 1.26430
   570  18.8 11924.3  3.808  4.440 1.25265
   580  19.2 11931.0  3.412  4.043 1.24105
   590  19.5 11911.1  3.636  4.266 1.22951
   600  19.8 11941.1  3.400  4.029 1.21801
   610  20.2 11904.0  3.431  4.060 1.20658
   620  20.5 11930.7  3.556  4.184 1.19520
   630  20.8 11946.5  3.294  3.921 1.18387
   640  21.1 11915.2  3.085  3.711 1.17259
   650  21.5 11958.6  3.596  4.221 1.16137
   660  21.8 11895.7  3.218  3.843 1.15020
   670  22.1 11866.8  3.218  3.841 1.13909
   680  22.5 11903.5  3.300  3.922 1.12803
   690  22.8 11898.1  3.201  3.823 1.11703
   700  23.1 11927.7  3.420  4.041 1.10608
   710  23.5 11955.9  3.217  3.838 1.09518
   720  23.8 11950.6  3.067  3.688 1.08434
   730  24.1 11884.1  3.134  3.754 1.07355
   740  24.5 11915.4  2.998  3.617 1.06281
   750  24.8 11949.3  3.213  3.832 1.05213
   760  25.1 11867.3  3.111  3.729 1.04150
   770  25.4 11918.4  3.002  3.620 1.03093
   780  25.8 11903.4  2.978  3.595 1.02041
   790  26.1 11893.1  2.915  3.532 1.00994
   800  26.4 11899.2  2.845  3.461 0.99953
   810  26.8 11926.2  2.926  3.542 0.98917
   820  27.1 11925.8  3.101  3.717 0.97887
   830  27.4 11909.1  2.832  3.447 0.96862
   840  27.8 11903.5  3.108  3.723 0.95842
   850  28.1 11937.6  2.624  3.238 0.94828
   860  28.4 11934.9  3.159  3.773 0.93819
   870  28.8 11933.5  2.750  3.364 0.92816
   880  29.1 11943.7  2.492  3.106 0.91818
   890  29.4 11929.8  2.831  3.445 0.90825
   900  29.7 11902.1  2.744  3.357 0.89838
   910  30.1 11929.6  2.800  3.413 0.88856
   920  30.4 11913.5  2.757  3.370 0.87880
   930  30.7 11937.9  2.583  3.196 0.86909
   940  31.1 11949.9  2.683  3.296 0.85943
   950  31.4 11902.4  2.643  3.255 0.84983
   960  31.7 11963.7  2.551  3.164 0.84028
   970  32.1 11926.6  2.722  3.334 0.83079
   980  32.4 11933.4  2.562  3.175 0.82134
   990  32.7 11896.2  2.717  3.329 0.81196
  1000  33.0 11907.6  2.340  2.952 0.80263
  1010  33.4 11923.1  2.371  2.983 0.79335
  1020  33.7 11914.0  2.537  3.149 0.78412
  1030  34.0 11939.6  2.547  3.159 0.77495
  1040  34.4 11911.7  2.649  3.261 0.76583
  1050  34.7 11899.7  2.451  3.063 0.75677
  1060  35.0 11966.3  2.239  2.852 0.74776
  1070  35.4 11895.0  2.408  3.020 0.73881
  1080  35.7 11913.2  2.590  3.203 0.72991
  1090  36.0 11930.5  2.100  2.713 0.72106
  1100  36.4 11913.7  2.292  2.905 0.71226
  1110  36.7 11954.9  2.448  3.061 0.70353
  1120  37.0 11940.6  2.188  2.801 0.69484
  1130  37.3 11923.6  2.400  3.013 0.68621
  1140  37.7 11934.7  2.177  2.791 0.67763
  1150  38.0 11877.6  2.366  2.980 0.66911
  1160  38.3 11925.7  2.126  2.740 0.66064
  1170  38.7 11914.5  2.225  2.840 0.65222
  1180  39.0 11897.6  2.150  2.764 0.64386
  1190  39.3 11924.0  2.265  2.880 0.63555
  1200  39.7 11852.6  2.559  3.174 0.62730
  1210  40.0 11908.2  2.295  2.910 0.61910
  1220  40.3 11884.0  2.126  2.742 0.61095
  1230  40.6 11934.3  2.097  2.713 0.60286
  1240  41.0 11915.2  2.066  2.683 0.59482
  1250  41.3 11950.7  2.073  2.689 0.58684
  1260  41.6 11928.4  1.748  2.365 0.57891
  1270  42.0 11928.6  1.885  2.503 0.57103
  1280  42.3 11890.2  2.015  2.633 0.56321
  1290  42.6 11910.2  1.894  2.512 0.55544
  1300  43.0 11912.1  2.007  2.625 0.54773
  1310  43.3 11920.0  1.848  2.467 0.54007
  1320  43.6 11895.1  1.884  2.503 0.53246
  1330  44.0 11906.0  2.056  2.675 0.52491
  1340  44.3 11943.9  2.144  2.764 0.51741
  1350  44.6 11940.9  2.096  2.717 0.50996
  1360  44.9 11894.0  1.712  2.333 0.50257
  1370  45.3 11924.3  1.803  2.424 0.49524
  1380  45.6 11896.6  1.834  2.455 0.48795
  1390  45.9 11885.0  1.975  2.597 0.48073
  1400  46.3 11934.4  1.984  2.607 0.47355
  1410  46.6 11897.4  1.927  2.550 0.46643
  1420  46.9 11911.6  1.878  2.501 0.45936
  1430  47.3 11939.2  1.822  2.446 0.45235
  1440  47.6 11887.9  1.799  2.424 0.44539
  1450  47.9 11930.0  1.629  2.254 0.43849
  1460  48.2 11911.4  1.721  2.347 0.43163
  1470  48.6 11914.1  1.560  2.186 0.42484
  1480  48.9 11950.1  1.425  2.052 0.41809
  1490  49.2 11858.1  1.570  2.197 0.41140
  1500  49.6 11888.8  1.551  2.178 0.40477
  1510  49.9 11973.2  1.627  2.256 0.39819
  1520  50.2 11911.5  1.653  2.282 0.39166
  1530  50.6 11933.5  1.538  2.168 0.38519
  1540  50.9 11892.7  1.900  2.529 0.37877
  1550  51.2 11897.6  1.634  2.264 0.37240
  1560  51.6 11937.6  1.637  2.268 0.36609
  1570  51.9 11925.8  1.513  2.144 0.35983
  1580  52.2 11921.6  1.581  2.214 0.35363
  1590  52.5 11912.2  1.561  2.193 0.34748
  1600  52.9 11899.6  1.569  2.202 0.34138
  1610  53.2 11873.6  1.702  2.336 0.33534
  1620  53.5 11874.3  1.476  2.111 0.32935
  1630  53.9 11938.4  1.512  2.147 0.32342
  1640  54.2 11936.6  1.667  2.302 0.31754
  1650  54.5 11919.8  1.399  2.035 0.31171
  1660  54.9 11913.3  1.828  2.465 0.30594
  1670  55.2 11915.8  1.504  2.141 0.30022
  1680  55.5 11926.7  1.790  2.428 0.29456
  1690  55.8 11850.5  1.453  2.091 0.28895
  1700  56.2 11902.4  1.400  2.039 0.28339
  1710  56.5 11919.2  1.625  2.265 0.27789
  1720  56.8 11922.3  1.480  2.121 0.27244
  1730  57.2 11933.0  1.409  2.050 0.26704
  1740  57.5 11923.1  1.370  2.011 0.26170
  1750  57.8 11926.8  1.585  2.226 0.25642
  1760  58.2 11941.7  1.399  2.042 0.25118
  1770  58.5 11896.3  1.477  2.120 0.24600
  1780  58.8 11917.2  1.507  2.151 0.24088
  1790  59.2 11912.5  1.357  2.001 0.23581
  1800  59.5 11923.9  1.504  2.149 0.23079
  1810  59.8 11891.6  1.295  1.940 0.22583
  1820  60.1 11900.9  1.472  2.117 0.22092
  1830  60.5 11949.0  1.280  1.926 0.21606
  1840  60.8 11913.7  1.279  1.926 0.21126
  1850  61.1 11883.0  1.442  2.090 0.20651
  1860  61.5 11911.3  1.093  1.741 0.20182
  1870  61.8 11927.9  1.279  1.927 0.19718
  1880  62.1 11934.9  1.441  2.090 0.19260
  1890  62.5 11888.3  1.120  1.769 0.18806
  1900  62.8 11928.8  1.208  1.857 0.18359
  1910  63.1 11938.1  1.416  2.066 0.17916
  1920  63.4 11892.0  1.048  1.698 0.17479
  1930  63.8 11928.5  1.228  1.878 0.17048
  1940  64.1 11874.9  1.096  1.746 0.16622
  1950  64.4 11896.0  1.206  1.856 0.16201
  1960  64.8 11889.0  1.353  2.004 0.15785
  1970  65.1 11895.0  1.144  1.795 0.15375
  1980  65.4 11966.4  0.965  1.616 0.14971
  1990  65.8 11911.5  1.156  1.806 0.14572
  2000  66.1 11910.9  1.057  1.707 0.14178
  2010  66.4 11894.2  1.145  1.795 0.13789
  2020  66.8 11914.1  0.984  1.634 0.13406
  2030  67.1 11918.8  0.990  1.639 0.13029
  2040  67.4 11930.8  0.974  1.623 0.12657
  2050  67.7 11909.1  0.804  1.453 0.12290
  2060  68.1 11906.8  0.871  1.520 0.11928
  2070  68.4 11893.0  1.035  1.683 0.11572
  2080  68.7 11949.1  0.828  1.477 0.11222
  2090  69.1 11915.3  0.914  1.562 0.10876
  2100  69.4 11906.3  0.814  1.462 0.10536
  2110  69.7 11905.1  0.897  1.544 0.10202
  2120  70.1 11857.6  0.727  1.374 0.09873
  2130  70.4 11920.0  0.870  1.516 0.09549
  2140  70.7 11845.7  0.799  1.445 0.09231
  2150  71.0 11926.2  0.702  1.348 0.08918
  2160  71.4 11914.4  0.698  1.343 0.08611
  2170  71.7 11922.3  0.659  1.304 0.08308
  2180  72.0 11895.2  0.616  1.260 0.08012
  2190  72.4 11922.0  0.629  1.273 0.07720
  2200  72.7 11919.3  0.737  1.381 0.07435
  2210  73.0 11914.0  0.877  1.521 0.07154
  2220  73.4 11887.0  0.798  1.441 0.06879
  2230  73.7 11944.4  0.872  1.515 0.06609
  2240  74.0 11903.7  0.887  1.530 0.06345
  2250  74.4 11904.3  0.698  1.340 0.06086
  2260  74.7 11948.4  0.756  1.397 0.05832
  2270  75.0 11946.8  0.745  1.387 0.05584
  2280  75.3 11943.9  0.711  1.352 0.05341
  2290  75.7 11916.0  0.597  1.237 0.05104
  2300  76.0 11911.5  0.732  1.372 0.04872
  2310  76.3 11879.3  0.697  1.337 0.04645
  2320  76.7 11909.5  0.750  1.390 0.04424
  2330  77.0 11916.8  0.760  1.399 0.04209
  2340  77.3 11913.0  0.649  1.288 0.03998
  2350  77.7 11918.4  0.750  1.389 0.03793
  2360  78.0 11930.0  0.691  1.329 0.03594
  2370  78.3 11899.3  0.895  1.533 0.03399
  2380  78.6 11882.4  0.663  1.301 0.03211
  2390  79.0 11932.8  0.606  1.244 0.03027
  2400  79.3 11871.1  0.611  1.248 0.02849
  2410  79.6 11909.2  0.431  1.068 0.02676
  2420  80.0 11922.4  0.592  1.229 0.02509
  2430  80.3 11922.4  0.626  1.263 0.02347
  2440  80.6 11934.6  0.721  1.357 0.02191
  2450  81.0 11898.5  0.592  1.228 0.02040
  2460  81.3 11914.3  0.712  1.348 0.01894
  2470  81.6 11777.4  0.661  1.297 0.01754
  2480  82.0 11919.5  0.630  1.266 0.01619
  2490  82.3 11926.1  0.703  1.339 0.01490
  2500  82.6 11909.0  0.554  1.190 0.01366
  2510  82.9 11926.6  0.642  1.278 0.01247
  2520  83.3 11917.3  0.623  1.258 0.01134
  2530  83.6 11893.8  0.441  1.076 0.01026
  2540  83.9 11918.1  0.633  1.268 0.00923
  2550  84.3 11915.2  0.608  1.243 0.00826
  2560  84.6 11926.6  0.555  1.190 0.00734
  2570  84.9 11868.2  0.755  1.390 0.00648
  2580  85.3 11918.3  0.512  1.147 0.00567
  2590  85.6 11895.4  0.625  1.260 0.00492
  2600  85.9 11897.8  0.574  1.209 0.00421
  2610  86.3 11884.5  0.544  1.179 0.00357
  2620  86.6 11923.9  0.467  1.102 0.00297
  2630  86.9 11767.6  0.412  1.047 0.00243
  2640  87.2 11941.2  0.697  1.332 0.00195
  2650  87.6 11885.9  0.552  1.187 0.00152
  2660  87.9 11887.5  0.548  1.183 0.00114
  2670  88.2 11834.1  0.500  1.134 0.00082
  2680  88.6 11945.3  0.506  1.141 0.00055
  2690  88.9 11903.6  0.684  1.319 0.00033
  2700  89.2 11889.5  0.730  1.364 0.00017
  2710  89.6 11910.1  0.519  1.154 0.00006
  2720  89.9 11905.8  0.581  1.215 0.00001

Top-1 accuracy: 40.522876381874084 %
Top-5 accuracy: 63.93861770629883 %
```


#### result, FP16, batch 256
```
FP16 256 batch 

rm -rf /mnt/hryu-pggan/result/try3  && cd /workspace/nvidia-examples && mpirun --allow-run-as-root  --bind-to socket   -np 16 python /workspace/nvidia-examples/cnn/resnet.py --data_dir=/mnt/hryu-pggan/dataset-tf/train-val-tfrecord-480-subset --log_dir=/mnt/hryu-pggan/result/try3   --layers=50  --precision=fp16   --num_iter=400  --iter_unit=batch  --batch_size 256

2018-10-18 01:53:17.599837: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:135] Shuffle buffer filled.
2018-10-18 01:53:17.641178: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:135] Shuffle buffer filled.
2018-10-18 01:53:17.823571: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:135] Shuffle buffer filled.
2018-10-18 01:53:17.964564: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:135] Shuffle buffer filled.
2018-10-18 01:53:17.991923: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:135] Shuffle buffer filled.
2018-10-18 01:53:18.013296: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:135] Shuffle buffer filled.
2018-10-18 01:53:18.699889: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:135] Shuffle buffer filled.
2018-10-18 01:53:18.974175: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:135] Shuffle buffer filled.
2018-10-18 01:53:19.132463: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:135] Shuffle buffer filled.
2018-10-18 01:53:19.237287: I tensorflow/core/kernels/data/shuffle_dataset_op.cc:135] Shuffle buffer filled.

  Step Epoch Img/sec   Loss  LR
    10   0.3  1137.6  7.667  8.638 1.98827
    20   0.7  9948.5  7.152  8.121 1.97365
    30   1.0 11466.7  6.917  7.881 1.95908
    40   1.3 11237.9  6.754  7.708 1.94457
    50   1.7 11965.1  6.593  7.537 1.93011
    60   2.0 11929.6  6.630  7.563 1.91571
    70   2.3 11909.9  6.249  7.169 1.90136
    80   2.6 11235.8  6.208  7.112 1.88706
    90   3.0 11914.4  6.067  6.954 1.87282
   100   3.3 11911.3  6.064  6.933 1.85863
   110   3.6 11947.6  5.907  6.761 1.84450
   120   4.0 11228.2  5.819  6.659 1.83042
   130   4.3 11427.0  5.873  6.699 1.81639
   140   4.6 11940.6  5.727  6.541 1.80242
   150   5.0 11934.2  5.757  6.561 1.78850
   160   5.3 11939.3  5.512  6.305 1.77464
   170   5.6 11909.2  5.542  6.325 1.76083
   180   5.9 11908.8  5.455  6.229 1.74707
   190   6.3 11908.4  5.135  5.901 1.73337
   200   6.6 11881.7  5.272  6.030 1.71972
   210   6.9 11915.5  5.201  5.951 1.70612
   220   7.3 11944.2  5.160  5.904 1.69258
   230   7.6 11903.9  5.130  5.868 1.67910
   240   7.9 11912.6  5.218  5.950 1.66566
   250   8.3 11878.6  4.779  5.506 1.65229
   260   8.6 11911.1  4.882  5.604 1.63896
   270   8.9 11892.1  4.941  5.659 1.62569
   280   9.3 11929.0  4.845  5.558 1.61247
   290   9.6 11928.6  4.619  5.328 1.59931
   300   9.9 11952.7  4.577  5.283 1.58620
   310  10.2 11915.2  4.671  5.373 1.57315
   320  10.6 11905.7  4.387  5.086 1.56014
   330  10.9 11930.3  4.341  5.037 1.54720
   340  11.2 11924.3  4.381  5.074 1.53430
   350  11.6 11867.3  4.585  5.275 1.52146
   360  11.9 11921.9  4.630  5.318 1.50868
   370  12.2 11903.2  4.171  4.856 1.49595
   380  12.6 11899.4  4.090  4.772 1.48327
   390  12.9 11886.2  4.409  5.090 1.47065
   400  13.2 11896.4  4.163  4.841 1.45808

Evaluating
Top-1 accuracy: 13.725490868091583 %
Top-5 accuracy: 31.08837604522705 %
```
